# Building an Open AI plugin with Codespaces and Azure

This is a sample repo for developing OpenAI plugin using the FastAPI framework. There are three main parts of the repo:
- Code to help setup development environment for FastAPI framework
- Code for the FastAPI app
- Code to help deploy the app on the cloud

## üì¶ Code to help setup development environment
Create a Codespaces by clicking **<> Code** -> **Codespaces** -> **Create codespaces on {branch}**, and a containerized development environment will be set up for you on the cloud based on the contents of the following files.

### **.devcontainer**
The `.devcontainer` folder contains files for defining a containerized development environment, specific to building this FastAPI app. It's set up in a way that makes it easy for you to use with GitHub Codespaces as well: launch a Codespace using this template, and you're ready to start developing! Learn more about devcontainers [here](https://containers.dev/).

### **.vscode**
The `.vscode` folder contains:
- `json.code-snippets` file that helps to quickly write the manifest file for the OpenAI plugin. (‚ú® Type `manifest-openai` then press `tab` to quickly generate a fill-in-the-blank manifest)
- `settings.json` file that helps to validate the manifest file (`ai-plugin.json`) against [this schema](https://github.com/minsa110/ai-plugin-schema/blob/main/ai-plugin-schema.json).
- `launch.json` file that helps to customize **Run and Debug**.

## üíª Code for the FastAPI app
If you have [access](https://code.visualstudio.com/blogs/2023/03/30/vscode-copilot#_getting-started-today) to [GitHub Copilot](https://github.com/features/copilot), try it out to help you write code faster. To test the app, run `uvicorn main:app` in the integrated terminal, or press `F5`, and debug CRUD operations at .../docs.

- `main.py` was the plugin code generated by Copilot. Learn more about Copilot here. The prompt used here is:
   ```markdown
   Write a simple TODO app using FastAPI, that lets the user add TODOs, list their TODOs, and delete TODOs, ensuring that the app stores item_id for each todo item.
 
   Include a __main__ section which will run this app using uvicorn. The Python module where I save this code will be called main.py.
 
   In addition to the normal endpoints, include a route .well-known/ai-plugin.json which serves (as JSON) the contents of ./ai-plugin.json, located in the same directory as main.py. Exclude this route from the OpenAPI spec, and don't serve any other static content.
   ```
- `ai-plugin.json` is a JSON manifest file that defines relevant metadata for the plugin.

## ‚òÅÔ∏è Code to help deploy the app on the cloud
This repo uses Azure Developer CLI to create two Azure Container Apps: one for the API and the other for the vector database (using Redis), then deploys the app. You can use the following commands to invoke the deployment flow:
```bash
azd auth login # for now, use azd login
azd init --template minsa110/devcontainer-fastapi # for specific branch, use -b {branch}
azd env set BEARER_TOKEN footoken
azd env set OPENAI_API_KEY {your open ai key}
azd up
```

- `azure.yaml` describes the application for Azure Developer CLI (`azd`). Learn more about Azure Developer CLI [here](https://learn.microsoft.com/en-us/azure/developer/azure-developer-cli/overview).
- `infra` folder contains infra-as-code files (Bicep) needed to provision the Azure resource.

## üí¨ Register the app on ChatGPT
- Copy the container app link and paste it to ChatGPT plugin
